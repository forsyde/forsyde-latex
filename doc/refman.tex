\title{The \textsc{ForSyDe-\LaTeX} utilities}
\author{
        George Ungureanu \\
                Department of Electronic Systems\\
        KTH---Royal Institute of Technology\\
        Stockholm, SWEDEN
}
\date{\today}

\documentclass[10pt]{article}
\usepackage[a4paper]{geometry}
\usepackage{forsyde-pc}
\usepackage[footnotesize]{caption}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{marginnote}
\usepackage{listings}
\pgfplotsset{compat=1.9}


\newenvironment{optionslist}[0]{ 
\begin{list}{}{
	\setlength{\itemindent}{-10pt}
%	\setlength{\topsep}{0pt}
	\setlength{\itemsep}{0pt}
	\setlength{\parsep}{0pt}
}}{\end{list}}
\newcommand\bookmark[1]{\marginpar{\ttfamily #1}}
\lstset{
  basicstyle=\footnotesize\ttfamily,
  numbers=left,
  frame=single,
  numberstyle=\tiny\color{black!30},
  commentstyle=\color{blue}\textit,
  stringstyle=\color{magenta}\textit,
  flexiblecolumns=false,
  basewidth={0.5em,0.45em},
  breaklines=true,
  language={[LaTeX]TeX},
  texcsstyle=*\color{red}\bfseries,
  keywordstyle=\color{blue}\bfseries,
  morekeywords={tikzpicture,document},
  moretexcs={trans,standard,interface,basic,cluster,node,path},
}
\def\opt#1{\color{gray}{#1}}
\def\man#1{\color{black}{#1}}

\begin{document}
\maketitle
\reversemarginpar

\begin{abstract}
This is the reference manual for the \LaTeX\ utilities used in the context of \textsc{ForSyDe}. All packages and their API features are documented here.
\end{abstract}

\section{Introduction}

This library was developed as an effort to standardize symbols and graphical primitives in documents related to \textsc{ForSyDe}, but also to provide tools and utilities for user convenience. \textsc{ForSyDe} is a high-level design methodology aiming at synthesizing correct-by-construction systems through formal means. For more information check \url{https://forsyde.ict.kth.se}.

The library contains the following main packages:
\begin{itemize}
\item \texttt{forsyde-tikz} : is a collection of \textsc{PGF} and
  \textsc{TikZ} styles, graphical primitives and commands for
  drawing \textsc{ForSyDe} process networks;
\item \texttt{forsyde-math} : is a collection of math symbols used in
  the \textsc{ForSyDe} formal notation. It is mainly focused on the
  ongoing \textsc{ForSyDe-Atom} methodology;
\item \texttt{forsyde-plot} : provides utilities for plotting
  \textsc{ForSyDe} signals;
\item \texttt{forsyde-legacy} : API for the previous versions of this
  library.
\end{itemize}

\section{Installation}

There are three main alternatives to use the libraries:

\begin{enumerate}
\item copy the contents of \texttt{forsyde-latex/src} under the \texttt{TEXMFHOME} path or any standard loading path, as specified by your \LaTeX\ compiler;
\item compile your document with the variable \texttt{TEXINPUTS} set to \texttt{/path/to/forsyde-latex/src/};
\item copy the contents of \texttt{forsyde-latex/src} in the same folder as your document and compile normally.
\end{enumerate}


\begin{figure}[htb]\centering
\includegraphics[width=\textwidth]{figs/example-forsyde-tikz}
\end{figure}

\lstinputlisting{figs/example-forsyde-tikz.tex}

\section{The \texttt{forsyde-tikz} package}

The \texttt{forsyde-tikz} package is included with

\begin{verbatim}
	\usepackage{forsyde-tikz}
\end{verbatim}


A \textsc{ForSyDe} process network is drawn like any other \textsc{TikZ} figure, inside a \texttt{tikzpicture} environment. The \texttt{options} provided are key variables defined by the \texttt{tikz} package. \bookmark{environment}

\begin{verbatim}
	\begin{tikzpicture}[options]
		content...
	\end{tikzpicture}
\end{verbatim}

Apart from the standard keys, \texttt{forsyde-tikz} provides the following variables:\bookmark{environment variables}
\begin{optionslist}
\item \texttt{no moc color} : disables process coloring according to their MoC.
\item \texttt{no moc label} : disables process labeling according to their MoC.
\item \texttt{label style=} : font style for the process type labels. Default is \texttt{\char`\\ textbf}.
\item \texttt{type style=} : font style for the process name labels. Default is \texttt{\char`\\ scriptsize\char`\\textit}.
\item \texttt{function style=} : font style for the functions. Default is \texttt{\char`\\ scriptsize}.
\end{optionslist}

\subsection{Main nodes}

Using \texttt{forsyde-tikz}, process networks are drawn using a combination of commands and style options for customizing shapes. 

\subsubsection{Draw commands}
\label{sec:draw-commands}

Inside the \texttt{tikzpicture} environment, one can use a set of draw commands which are used as templates for placing shapes and information provided as arguments. In the following listing, the \opt{gray}\man{} arguments are optional while the \man{black} ones are mandatory. 
The library also provide as set of helper styles for setting several options at once, presented in \ref{sec:helper-options}.\\

\begin{figure}[htb]\centering
\includegraphics{figs/example-node-basic}
\lstinputlisting[linerange={5-5}]{figs/example-node-basic.tex}
\caption{The \texttt{\char`\\basic} draw command. The red dots are custom anchors, accessed with \texttt{[name]-f.[anchor]}.}
\end{figure}
\hspace{1pt}\bookmark{\char`\\basic\opt{[options]}\opt{(name)}\opt{<position>}\man{\{label\}};}

\noindent The basic node is the simplest depiction of a function (e.g., process, atom) with maximum one argument. It is the most lightweight graphical primitive, and does not contain port anchors. It can be customized with the following keys (check \ref{sec:helper-options} for composite options):

\begin{optionslist}
\item \texttt{shape=} any \texttt{TikZ} style option for the node shape. Check section \ref{sec:provided-shapes} for a list of library-provided shapes. Default is \texttt{rectangle}.
\item \texttt{nf=[0..1]} the number of passed functions. Default is \texttt{0}. If \texttt{nf>1} then \texttt{nf=1}.
\item \texttt{f1=} function label. Appears as a box above the main shape in case \texttt{nf > 0}. Default is $f_1$.
\item \texttt{anchor=[anchor]} center point for shape. Default is \texttt{center}.
\item \texttt{xshift=[distance]} shift position in X direction. Default is \texttt{0pt}.
\item \texttt{yshift=[distance]} shift position in Y direction. Default is \texttt{0pt}.
\end{optionslist}


\begin{figure}[htb]\centering
\includegraphics{figs/example-node-standard}
\lstinputlisting[linerange={5-5}]{figs/example-node-standard.tex}
\caption{The \texttt{\char`\\standard} draw command. The function anchors are accessed with \texttt{[name]-f.[anchor]} and the port anchors are accessed with \texttt{[name].[anchor]}}
\end{figure}
\hspace{1pt}\bookmark{\char`\\standard\opt{[options]}\opt{(name)}\opt{<position>}\man{\{label\}};}

\noindent The standard node is a more complex depiction of a ForSyDe block. It contains anchors for each port, shows a label and the constructor name, and its field is colored according to a MoC (if this is the case). It can be customized with the following keys (check \ref{sec:helper-options} for composite options):

\begin{optionslist}
\item \texttt{class=[sy|de|ct|sdf|blackbox|none]} The class of the node. This option affects the field color and the constructor label. Default is \texttt{none}.
\item \texttt{hasmoc} flag for saying that this node is a process, therefore it is associated with a MoC. It need to be provided otherwise the global flags will ignore MoC-related options (e.g. \texttt{nomoccolor}).
\item \texttt{shape=} any \texttt{TikZ} style option for the node shape. Check section \ref{sec:provided-shapes} for a list of library-provided shapes. Default is \texttt{rectangle}.
\item \texttt{type=} the type / constructor of that particular ForSyDe block. It shows below the main label and it is affected by the \texttt{class} argument.
\item \texttt{npw=[0..10]} number of ports on the left side of the node, i.e. the number of left port anchors.
\item \texttt{ni=[0..10]} alias for \texttt{npw}, stands for ``number of inputs''.
\item \texttt{npe=[0..10]} number of ports on the right side of the node, i.e. the number of right port anchors.
\item \texttt{no=[0..10]} alias for \texttt{npe}, stands for ``number of outputs''.
\item \texttt{nf=[0..4]} the number of passed functions. Default is \texttt{0}.
\item \texttt{f1=} first function label. Appears as a box in the upper part in case \texttt{nf > 0}. Default is $f_1$.
\item \texttt{f2=} second function label. Appears as a box in the upper part in case \texttt{nf > 1}. Default is $f_2$.
\item \texttt{f3=} third function label. Appears as a box in the upper part in case \texttt{nf > 2}. Default is $f_3$.
\item \texttt{f4=} fourth function label. Appears as a box in the upper part in case \texttt{nf > 3}. Default is $f_4$.
\item \texttt{anchor=[anchor]} center point for shape. Default is \texttt{center}.
\item \texttt{xshift=[distance]} shift position in X direction. Default is \texttt{0pt}.
\item \texttt{yshift=[distance]} shift position in Y direction. Default is \texttt{0pt}.
\item \texttt{rotate=[number]} the rotation angle (in degrees) of the node. Default is \texttt{0}.
\item \texttt{rotate shape=[number]} the rotation angle (in degrees) of the \texttt{shape}. Defailt is \texttt{0}.
\item \texttt{inner ysep=[distance]} the distance between the function node, the label node and the type node. Default is \texttt{3pt}.
\end{optionslist}

\begin{figure}[htb]\centering
\includegraphics{figs/example-node-interface}
\lstinputlisting[linerange={5-5}]{figs/example-node-interface.tex}
\caption{The \texttt{\char`\\trans} draw command. The function anchors are accessed with \texttt{[name]-f.[anchor]} and the port anchors are accessed with \texttt{[name].[anchor]}}
\end{figure}
\hspace{1pt}\bookmark{\char`\\interface\opt{[options]}\opt{(name)}\opt{<position>}\man{\{domain~left\}}\man{\{domain~right\}};}

\noindent This command draws an interface from one domain to another (e.g. a MoC interface). It can be customized with the following keys (check \ref{sec:helper-options} for composite options):

\begin{optionslist}
\item \texttt{anchor=[anchor]} center point for shape. Default is \texttt{center}.
\item \texttt{xshift=[distance]} shift position in X direction. Default is \texttt{0pt}.
\item \texttt{yshift=[distance]} shift position in Y direction. Default is \texttt{0pt}.
\item \texttt{rotate=[number]} the rotation angle (in degrees) of the node. Default is \texttt{0}.
\end{optionslist}


\begin{figure}[htb]\centering
\includegraphics{figs/example-node-trans}
\lstinputlisting[linerange={5-5}]{figs/example-node-trans.tex}
\caption{The \texttt{\char`\\trans} draw command. The function anchors are accessed with \texttt{[name]-f.[anchor]} and the port anchors are accessed with \texttt{[name].[anchor]}}
\end{figure}
\hspace{1pt}\bookmark{\char`\\trans\opt{[options]}\opt{(name)}\opt{<position>}\man{\{\}};}

\noindent This command draws a transversal node over a path (usually 90 degrees), which symbolizes a structural transition of the path's type (e.g. permutation). The label is ignored, but the brackets are necessary to mark the end of the arguments. It can be customized with the following keys (check \ref{sec:helper-options} for composite options):

\begin{optionslist}
\item \texttt{shape=} any \texttt{TikZ} style option for the node shape. Check section \ref{sec:provided-shapes} for a list of library-provided shapes. Default is \texttt{rectangle}.
\item \texttt{type=} the type / constructor of that particular ForSyDe block. It is shown as the main label, rotated at 90 degrees.
\item \texttt{npw=[0..10]} number of ports on the left side of the node, i.e. the number of left port anchors.
\item \texttt{ni=[0..10]} alias for \texttt{npw}, stands for ``number of inputs''.
\item \texttt{npe=[0..10]} number of ports on the right side of the node, i.e. the number of right port anchors.
\item \texttt{no=[0..10]} alias for \texttt{npe}, stands for ``number of outputs''.
\item \texttt{nf=[0..4]} the number of passed functions. Default is \texttt{0}.
\item \texttt{f1=} first function label. Appears as a box in the upper part in case \texttt{nf > 0}. Default is $f_1$.
\item \texttt{f2=} second function label. Appears as a box in the upper part in case \texttt{nf > 1}. Default is $f_2$.
\item \texttt{f3=} third function label. Appears as a box in the upper part in case \texttt{nf > 2}. Default is $f_3$.
\item \texttt{f4=} fourth function label. Appears as a box in the upper part in case \texttt{nf > 3}. Default is $f_4$.
\item \texttt{anchor=[anchor]} center point for shape. Default is \texttt{center}.
\item \texttt{xshift=[distance]} shift position in X direction. Default is \texttt{0pt}.
\item \texttt{yshift=[distance]} shift position in Y direction. Default is \texttt{0pt}.
\item \texttt{rotate=[number]} the rotation angle (in degrees) of the node. Default is \texttt{0}.
\item \texttt{rotate shape=[number]} the rotation angle (in degrees) of the \texttt{shape}. Defailt is \texttt{0}.
\item \texttt{inner ysep=[distance]} the distance between the function node, the label node and the type node. Default is \texttt{3pt}.
\end{optionslist}

\begin{figure}[htb]\centering
\includegraphics{figs/example-node-cluster}
\lstinputlisting[linerange={5-7}]{figs/example-node-cluster.tex}
\caption{The \texttt{\char`\\cluster} draw command. The function anchors are accessed with \texttt{[name]-f.[anchor]}, the port anchors are accessed with \texttt{[name].[anchor]} and the cluster outer shape edges are named \texttt{[name]-[position]}}
\end{figure}
\hspace{1pt}\bookmark{\char`\\cluster\opt{[options]}\opt{(name)}\man{<list~of~clustered~nodes>}\man{\{label\}};}

\noindent This command draws a cluster around other nodes. Instead of a position, it requires a list of nodes to fit. Apart from the functions and port anchors as seen in the previous commands, this command provides the edges of the outer shape cluster as names. These names can be used further in computing intersection points. It can be customized with the following keys (check \ref{sec:helper-options} for composite options):

\begin{optionslist}
\item \texttt{class=[sy|de|ct|sdf|blackbox|none]} The class of the node. This option affects the field color and the constructor label. Default is \texttt{none}.
\item \texttt{hasmoc} flag for saying that this node is a process, therefore it is associated with a MoC. It need to be provided otherwise the global flags will ignore MoC-related options (e.g. \texttt{nomoccolor}).
\item \texttt{shape=} any \texttt{TikZ} style option for the node shape. Check section \ref{sec:provided-shapes} for a list of library-provided shapes. Default is \texttt{rectangle}.
\item \texttt{type=} the type / constructor of that particular ForSyDe block. It shows below the main label and it is affected by the \texttt{class} argument.
\item \texttt{npw=[0..10]} number of ports on the left side of the node, i.e. the number of left port anchors.
\item \texttt{ni=[0..10]} alias for \texttt{npw}, stands for ``number of inputs''.
\item \texttt{npe=[0..10]} number of ports on the right side of the node, i.e. the number of right port anchors.
\item \texttt{no=[0..10]} alias for \texttt{npe}, stands for ``number of outputs''.
\item \texttt{nf=[0..4]} the number of passed functions. Default is \texttt{0}.
\item \texttt{f1=} first function label. Appears as a box in the upper part in case \texttt{nf > 0}. Default is $f_1$.
\item \texttt{f2=} second function label. Appears as a box in the upper part in case \texttt{nf > 1}. Default is $f_2$.
\item \texttt{f3=} third function label. Appears as a box in the upper part in case \texttt{nf > 2}. Default is $f_3$.
\item \texttt{f4=} fourth function label. Appears as a box in the upper part in case \texttt{nf > 3}. Default is $f_4$.
\item \texttt{anchor=[anchor]} center point for shape. Default is \texttt{center}.
\item \texttt{xshift=[distance]} shift position in X direction. Default is \texttt{0pt}.
\item \texttt{yshift=[distance]} shift position in Y direction. Default is \texttt{0pt}.
\item \texttt{rotate=[number]} the rotation angle (in degrees) of the node. Default is \texttt{0}.
\item \texttt{rotate shape=[number]} the rotation angle (in degrees) of the \texttt{shape}. Defailt is \texttt{0}.
\item \texttt{inner xsep=[distance]} the inner separation in X direction. Default is \texttt{3pt}.
\item \texttt{inner ysep=[distance]} the inner separation in Y direction. Default is \texttt{3pt}.
\end{optionslist}

\subsubsection{Shapes}
\label{sec:provided-shapes}
\bookmark{node shapes}
\textsc{ForSyDe-TikZ} provides a collection of raw shapes either as \textsc{TikZ} styles or as low-level \textsc{PGF} drawings. They are often used as arguments for drawing commands. Below is a list with them and their usage:


\begin{longtable} { | p{3cm} | c | p{9cm} | }
  \toprule
  \textbf{Shape}  & \textbf{Drawing} & \textbf{Description} \\
  \midrule
  \texttt{atom shape}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[atom shape] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\basic} command, it is a good candidate for depicting ForSyDe atoms or other primitive blocks.
  \\
  \texttt{nary atom shape}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[nary atom shape] {}; \end{tikzpicture}
  & similar to \texttt{atom shape}, but suggests an n-tuple of blocks.
  \\
  \texttt{leaf shape}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[leaf shape, inner sep=7pt] {}; \end{tikzpicture}
  &  meant to be used with the \texttt{\char`\\standard} command, it is a good candidate for depicting abstractions of complex semantics (e.g. black boxes).
  \\
  \texttt{nary leaf shape}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[nary leaf shape, inner sep=7pt] {}; \end{tikzpicture}
  & similar to \texttt{leaf shape}, but suggests an n-tuple of blocks.
  \\
  \texttt{comp shape}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[comp shape, inner sep=7pt] {}; \end{tikzpicture}
  &  meant to be used with the \texttt{\char`\\cluster} command, it is a good candidate for depicting exposed hierarchical blocks such as composite processes.
  \\
  \texttt{nary comp shape}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[nary comp shape, inner sep=7pt] {}; \end{tikzpicture}
  & similar to \texttt{leaf shape}, but suggests an n-tuple of blocks.
  \\
  \texttt{\texttt{ports e[0..10]w[0..10]}}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[ports e1w1] {}; \end{tikzpicture}
  & these are multiple shapes that have no drawing, but define additional anchors\footnote{apart from the ones inherited from \texttt{rectangle}} for ports on the east (\texttt{.e[index]}) and west (\texttt{.w[index]}) sides of the node. It is meant to fit around an existing shape. 
  \\
  \texttt{\texttt{func[0..4]}}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[func4] {\functionlabels{4}{a}{b}{c}{d}}; \end{tikzpicture}
  & these shapes create a series of boxes with text and for each box two anchors: north (\texttt{.n[index]}), south (\texttt{.s[index]}). They are used to show functions as input arguments.
  \\
  \texttt{\texttt{dp shape}}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[dp shape, inner sep=7pt] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\cluster} command, this shape suggests a data parallel skeleton.
  \\
  \texttt{\texttt{pipe shape}}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[pipe shape, inner sep=7pt] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\cluster} command, this shape suggests a pipeline skeleton.
  \\
  \texttt{\texttt{merge shape}}
  & \vspace{0pt} \begin{tikzpicture}[baseline] \node[merge shape, inner sep=7pt] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\cluster} command, this shape suggests a reduce/recur skeleton.
  \\
  \texttt{\texttt{generic skel shape}}
  & \vspace{0pt}\begin{tikzpicture}[baseline] \node[generic skel shape, inner sep=7pt] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\cluster} command, this shape suggests generic skeleton which implies a recursive composition of functions/blocks.
  \\
  \texttt{\texttt{trans shape v[1..8]v[1..8]}}
  & \vspace{0pt}\begin{tikzpicture}[baseline] \node[trans shape v2v3, inner ysep=10pt] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\trans} command, this shape suggests a transition in the structure of \texttt{n} input vectors resulting in \texttt{n'} output vectors.
  \\
  \texttt{\texttt{trans shape s1v1}}
  & \vspace{0pt}\begin{tikzpicture}[baseline] \node[trans shape s1v1, inner ysep=10pt] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\trans} command, this shape suggests a transposition of a vector to/from a stream.
  \\
  \texttt{\texttt{trans shape v1gv1}}
  & \vspace{0pt}\begin{tikzpicture}[baseline] \node[trans shape v1gv1, inner ysep=10pt] {}; \end{tikzpicture}
  & meant to be used with the \texttt{\char`\\trans} command, this shape suggests a grouping/merging to/from a vector of vectors.
  \\
  \bottomrule
\end{longtable}

\subsubsection{Helper options}
\label{sec:helper-options}

\bookmark{node helper keys}
The \texttt{forsyde-tikz} library provides a large set of styles or function keys that can be used for user convenience as options in the draw commands shown in section \ref{sec:draw-commands}. 

\begin{longtable} { r|p{11cm} }
  \toprule
  \textbf{Key}  & \textbf{Description/Expands to}  \\
  \midrule
  \texttt{moc=x} & \texttt{hasmoc, class=x} \\
  \texttt{inner sep=x} & \texttt{inner xsep=x, inner ysep=x} \\
  \texttt{left of=x} & positions left of node \texttt{x}, with an edge-to-edge distance = 1cm \\
  \texttt{right of=x} & positions right of node \texttt{x}, with an edge-to-edge distance = 1cm \\
  \texttt{above of=x} & positions above of node \texttt{x}, with an edge-to-edge distance = 1cm \\
  \texttt{below of=x} & positions below of node \texttt{x}, with an edge-to-edge distance = 1cm \\
  \texttt{f=\{a;b;c;d\}} & parses a string of functions separated by \texttt{;} and sets \texttt{nf}, \texttt{f1}, \texttt{f2}, \texttt{f3} and \texttt{f4} accordingly \\
  \texttt{primitive} & \texttt{shape=atom shape} \\
  \texttt{primitiven} & \texttt{shape=nary atom shape} \\
  \texttt{process} & \texttt{shape=leaf shape, hasmoc} \\
  \texttt{processn} & \texttt{shape=nary leaf shape, hasmoc} \\
  \texttt{composite} & \texttt{shape=comp shape} \\
  \texttt{compositen} & \texttt{shape=comp shape} \\
  \texttt{embed} & \texttt{shape=leaf shape, hasmoc, inner sep=15pt} \\
  \texttt{farmstyle} & \texttt{shape=dp shape, inner xsep = 15pt, inner ysep = 20pt,} \\
  \texttt{pipestyle} & \texttt{shape=pipe shape, inner xsep = 15pt, inner ysep = 20pt,} \\
  \texttt{skeleton} & \texttt{shape=generic skel shape, inner xsep = 15pt, inner ysep = 20pt,} \\
  \texttt{transition=v2v3} & \texttt{shape=trans shape v2v3}. Default argument is \texttt{v1v1}. \\
  \texttt{zipx} & \texttt{transition={s1v1}, rotate shape=180, type=zipx,} \\
  \texttt{unzipx} & \texttt{transition={s1v1}, type=unzipx,} \\
  \bottomrule
\end{longtable}


\subsection{Paths}

Data flow in \texttt{forsyde-tikz} is represented as (directed) edges between components. These are regular \textsc{TikZ} paths, customized with a series of keys provided by the library. There are obvious advantages for using the \textsc{TikZ} infrastructure, such as being able to further customize paths outside the scope of this library, or reuse existing keys (e.g. the arrow tips, shapes). The custom port or function anchors presented in the previous section come in handy when considering port-to-port connections. 

The library provides the following custom keys:\bookmark{path keys}

\begin{optionslist}
\item \texttt{s=[MoC]} draws a signal. If the global options allow it, passing a MoC string to this key will color the signal accordingly. 
\item \texttt{sn=[MoC]} draws an n-tuple of signals. If the global options allow it, passing a MoC string to this key will color the signal accordingly. 
\item \texttt{v=[MoC]} draws a vector. If the global options allow it, passing a MoC string to this key will color the vector accordingly, suggesting that it contains signals of their respective MoC.
\item \texttt{vn=[MoC]} draws an n-tuple of vectors. If the global options allow it, passing a MoC string to this key will color the vector accordingly, suggesting that it contains signals of their respective MoC.
\item \texttt{f} draws an edge used for showing how functions and parameters are passed from higher order functions downwards into the hierarchy.  
\item \texttt{fn} similar to \texttt{f}, but for n-tuples of functions.  
\item \texttt{token=[scalar,vector,function,scalarAE,vectorAE,functionAE]} draws symbols for depicting the token structure of ForSyDe signals or vectors. Function paths will ignore this key. To draw tuple structures you have to separate token keywords by \texttt{-} (dash). E.g.: 3-tuple of scalar, absent extended vector and function can be drawn with \texttt{token=scalar-vectorAE-function}.
\item \texttt{token pos=[0.0 .. 1.0]} the position between the start node/anchor and the end node/anchor where the token begins to be drawn.
\item \texttt{-|-=[0.0 .. 1.0]} will create a horizontal-vertical-horizontal spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
\item \texttt{|-|=[0.0 .. 1.0]} will create a vertical-horizontal-vertical spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
\item \texttt{-|-=[0.0 .. 1.0]} will create a horizontal-vertical-horizontal spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
\item \texttt{-|-|=[0.0 .. 1.0]} will create a horizontal-vertical-horizontal-vertical spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
\item \texttt{-|-|-=[0.0 .. 1.0]:[0.0 .. 1.0]} will create a horizontal-vertical-horizontal-vertical-horizontal spline in the path. It may be accompanied by two numbers  separated by \texttt{:} which determine the position of the 90 degree angles.
\item \texttt{|-|-|=[0.0 .. 1.0]:[0.0 .. 1.0]} will create a vertical-horizontal-vertical-horizontal-vertical spline in the path. It may be accompanied by two numbers  separated by \texttt{:} which determine the position of the 90 degree angles.
\item \texttt{deviation=} is a length representing the deviation from the straight path in case of complex splines (\texttt{-|-|},\texttt{-|-|-} and \texttt{|-|-|}).
\end{optionslist}


% \hspace{1pt}\bookmark{\char`\\signal[options]~(from)~shape~(to);}

% \hspace{1pt}\bookmark{\char`\\vector[options]~(from)~shape~(to);}


% \begin{lstlisting}
% \signal[]                                     (0,2)  ->  (1.5,2); 
% \signal[moc=ct, token=vectorAE-functionAE]    (2,2)  <-  (3.5,2);
% \signal[moc=sy, -|-|-=0.2:0.6, deviate=-10pt] (4,2)  p->p (5.5,2);
% \signal[token=scalarAE, -|-]                  (6,1.7) ->p (7.5,2.3);
% \signal[token pos=0.2, token=scalar-vector]   (8,2)  ->  (9.5,2);
% \end{lstlisting}

% \begin{figure}[htb!]\centering
% \begin{tikzpicture}[]
% 	\signal[]                                     (0,2)  ->  (1.5,2); 
% 	\signal[moc=ct, token=vectorAE-functionAE]    (2,2)  <-  (3.5,2);
% 	\signal[moc=sy, -|-|-=0.2:0.6, deviate=-10pt] (4,2)  p->p (5.5,2);
% 	\signal[token=scalarAE, -|-]                  (6,1.7) ->p (7.5,2.3);
% 	\signal[token pos=0.2, token=scalar-vector]   (8,2)  ->  (9.5,2);
% \end{tikzpicture}
% \end{figure}

% \begin{lstlisting}
% \vector[token=scalar-scalar-scalar-scalar] (0,1) p->p (2,1);	
% \vector[moc=sdf]                           (3,1) p->p (5,1);
% \vector[token=vectorAE, token pos=0.35]    (6,1) p->p (8,1);
% \end{lstlisting}

% \begin{figure}[htb!]\centering
% \begin{tikzpicture}[]
% 	\vector[token=scalar-scalar-scalar-scalar] (0,1) p->p (2,1);	
% 	\vector[moc=sdf]                           (3,1) p->p (5,1);
% 	\vector[token=vectorAE, token pos=0.35]    (6,1) p->p (8,1);
% \end{tikzpicture}
% \end{figure}


% \hspace{1pt}\bookmark{\char`\\function[options]~(from)~shape~(to);}
% \begin{optionslist}
% \item \texttt{-|-=[0.0 .. 1.0]} will create a horizontal-vertical-horizontal spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
% \item \texttt{|-|=[0.0 .. 1.0]} will create a vertical-horizontal-vertical spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
% \item \texttt{-|-=[0.0 .. 1.0]} will create a horizontal-vertical-horizontal spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
% \item \texttt{-|-|=[0.0 .. 1.0]} will create a horizontal-vertical-horizontal-vertical spline in the path. It may be accompanied by a number which determines the position of the 90 degree angle.
% \item \texttt{-|-|-=[0.0 .. 1.0]:[0.0 .. 1.0]} will create a horizontal-vertical-horizontal-vertical-horizontal spline in the path. It may be accompanied by two numbers  separated by \texttt{:} which determine the position of the 90 degree angles.
% \item \texttt{|-|-|=[0.0 .. 1.0]:[0.0 .. 1.0]} will create a vertical-horizontal-vertical-horizontal-vertical spline in the path. It may be accompanied by two numbers  separated by \texttt{:} which determine the position of the 90 degree angles.
% \item \texttt{deviation=} is a length representing the deviation from the straight path in case of complex splines (\texttt{-|-|},\texttt{-|-|-} and \texttt{|-|-|}).
% \end{optionslist}

% \begin{lstlisting}
% \function[] (0,0) -> (2,0);
% \function[|-|=.6] (3,.5) fi-> (4,-.5);
% \function[|-|-|] (5,.5) <- (5,-.5);
% \end{lstlisting}

% \begin{figure}[htb!]\centering
% \begin{tikzpicture}[]
% 	\function[] (0,0) -> (2,0);
% 	\function[|-|=.6] (3,.5) fi-> (4,-.5);
% 	\function[|-|-|] (5,.5) <- (5,-.5);
% \end{tikzpicture}
% \end{figure}

% \subsection{Miscellaneous functions}

% Following is a list of miscellaneous functions and environments provided for user convenience:\\

% \hspace{1pt}\bookmark{\texttt{\string\textleftof\{node\}\{text\}}}

% \hspace{1pt}\bookmark{\texttt{\string\textrightof\{node\}\{text\}}}

% \hspace{1pt}\bookmark{\texttt{\string\textaboveof\{node\}\{text\}}}

% \hspace{1pt}\bookmark{\texttt{\string\textbelowof\{node\}\{text\}}}


% \subsection{Further customizing the environment}

% The following commands can be used in the document preamble for changing environment variables.
% \begin{lstlisting}
% % Colors
% \renewcommand{\defaultdrawcolor}{[color]}
% \renewcommand{\defaultfillcolor}{[color]}
% \definecolor{sycolor}{[coord sys]}{[color coord]}
% \definecolor{ctcolor}{[coord sys]}{[color coord]}
% \definecolor{decolor}{[coord sys]}{[color coord]}
% \definecolor{sdfcolor}{[coord sys]}{[color coord]}
% \definecolor{blackboxcolor}{[coord sys]}{[color coord]}}
% % line widths
% \pgfmathsetlength{\sepq}{[size]}           % small inter-node separation 
% \renewcommand{\compositelinewidth}{[size]}
% \renewcommand{\skeletonlinewidth}{[size]}  % parallel processes line width
% \renewcommand{\signalpathlinewidth}{[size]}
% \renewcommand{\functionpathlinewidth}{[size]}
% \renewcommand{\vectorpathlinewidth}{[size]}
% % sizes, etc.
% \renewcommand{\tokensize}{[size]}
% \renewcommand{\halftokensize}{[size]}
% \renewcommand{\vectorportsize}{[size]}
% \renewcommand{\signalportsize}{[size]}
% \end{lstlisting}

% \section{The \texttt{forsyde-pc} package}

% The \texttt{forsyde-pc} package includes \textsc{ForSyDe} process constructors, written as macros. For a detailed theoretical background in process constructors check the \textsc{ForSyDe} homepage. It is included with: 

% \begin{verbatim}
% 	\usepackage{forsyde-pc}
% \end{verbatim}

% Following is a list with all process constructors including valid option keys:

% \begin{lstlisting}
% \delay    [moc=,f1=,inner sep=,reverse]        {id}{pos}{label}
% \delayn   [moc=,f1=,f2=,inner sep=,reverse]    {id}{pos}{label}
% \map      [moc=,f1=,inner sep=,reverse]        {id}{pos}{label}
% \comb     [moc=,f1=,inner sep=,reverse]        {id}{pos}{label}
% \combII   [moc=,f1=,inner sep=,reverse]        {id}{pos}{label}
% \combIII  [moc=,f1=,inner sep=,reverse]        {id}{pos}{label}
% \combIV   [moc=,f1=,inner sep=,reverse]        {id}{pos}{label}
% \scanl    [moc=,f1=,f2=,inner sep=,reverse]    {id}{pos}{label}
% \scanlII  [moc=,f1=,f2=,inner sep=,reverse]    {id}{pos}{label}
% \scanlIII [moc=,f1=,f2=,inner sep=,reverse]    {id}{pos}{label}
% \scanld   [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \scanldII [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \scanldIII[moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \moore    [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \mooreII  [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \mooreIII [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \mealy    [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \mealyII  [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \mealyIII [moc=,f1=,f2=,f3=,inner sep=,reverse]{id}{pos}{label}
% \source   [moc=,f1=,f2=,inner sep=,reverse]    {id}{pos}{label}
% \filter   [moc=,f1=,f2=,inner sep=,reverse]    {id}{pos}{label}
% \hold     [moc=,f1=,inner sep=,reverse]        {id}{pos}{label}
% \fillS    [moc=,f1=,f2=,inner sep=,reverse]    {id}{pos}{label}

% \zip     [moc=,reverse]{id}{pos}
% \zipIII  [moc=,reverse]{id}{pos}
% \zipIV   [moc=,reverse]{id}{pos}
% \zipV    [moc=,reverse]{id}{pos}
% \zipVI   [moc=,reverse]{id}{pos}
% \unzip   [moc=,reverse]{id}{pos}
% \unzipIII[moc=,reverse]{id}{pos}
% \unzipIV [moc=,reverse]{id}{pos}
% \unzipV  [moc=,reverse]{id}{pos}
% \unzipVI [moc=,reverse]{id}{pos}

% \domaininterface[moc=,reverse]          {id}{pos}
% \mocinterface   [mocin=,mocout=,reverse]{id}{pos}

% \composite[ni=,no=,inner xsep=,inner ysep=,reverse] {id}{included}{label}
% \blackbox [ni=,no=,inner xsep=,inner ysep=,reverse] {id}{included}{label}

% \farm     [ni=,no=,inner xsep=,inner ysep=,reverse]                {id}{included}{label}
% \farmI    [ni=,no=,f1=,inner xsep=,inner ysep=,reverse]            {id}{included}{label}
% \farmII   [ni=,no=,f1=,f2=,inner xsep=,inner ysep=,reverse]        {id}{included}{label}
% \farmIII  [ni=,no=,f1=,f2=,f3=,inner xsep=,inner ysep=,reverse]    {id}{included}{label}
% \farmIV   [ni=,no=,f1=,f2=,f3=,f4=,inner xsep=,inner ysep=,reverse]{id}{included}{label}
% \pipe     [ni=,no=,inner xsep=,inner ysep=,reverse]                {id}{included}{label}
% \pipeI    [ni=,no=,f1=,inner xsep=,inner ysep=,reverse]            {id}{included}{label}
% \pipeII   [ni=,no=,f1=,f2=,inner xsep=,inner ysep=,reverse]        {id}{included}{label}
% \pipeIII  [ni=,no=,f1=,f2=,f3=,inner xsep=,inner ysep=,reverse]    {id}{included}{label}
% \pipeIV   [ni=,no=,f1=,f2=,f3=,f4=,inner xsep=,inner ysep=,reverse]{id}{included}{label}
% \reduce   [ni=,no=,inner xsep=,inner ysep=,reverse]                {id}{included}{label}
% \reduceI  [ni=,no=,f1=,inner xsep=,inner ysep=,reverse]            {id}{included}{label}
% \reduceII [ni=,no=,f1=,f2=,inner xsep=,inner ysep=,reverse]        {id}{included}{label}
% \reduceIII[ni=,no=,f1=,f2=,f3=,inner xsep=,inner ysep=,reverse]    {id}{included}{label}
% \reduceIV [ni=,no=,f1=,f2=,f3=,f4=,inner xsep=,inner ysep=,reverse]{id}{included}{label}

% \unzipx     [reverse]         {id}{position}
% \zipx       [reverse]         {id}{position}
% \unzipv     [reverse]         {id}{position}
% \zipv       [reverse]         {id}{position}
% \splitatv   [f1=,reverse]     {id}{position}
% \catv       [reverse]         {id}{position}
% \oddsv      [reverse]         {id}{position}
% \evensv     [reverse]         {id}{position}
% \reversev   [reverse]         {id}{position}
% \groupv     [reverse]         {id}{position}
% \concatv    [reverse]         {id}{position}
% \filteridxv [f1=,reverse]     {id}{position}
% \gatherv    [f1=,f2=,reverse] {id}{position}
% \gatherAdpv [f1=,f2=,reverse] {id}{position}
% \selectv    [reverse]         {id}{position}
% \distributev[f1=,reverse]     {id}{position}
% \filterv    [f1=,reverse]     {id}{position}
% \getv       [f1=,reverse]     {id}{position}

% \visualoddsv   [reverse]{id}{pos}
% \visualevensv  [reverse]{id}{pos}
% \visualreversev[reverse]{id}{pos}
% \visualgroupv  [reverse]{id}{pos}
% \visualconcatv [reverse]{id}{pos}
% \end{lstlisting}

% \newpage
% \section
% \section{PGF nodes} \label{section_shapes}

% All graphical elements in the \texttt{forsyde-tikz} package are created using custom PGF shapes defined in \texttt{tikzlibraryfshapes.code.tex}. You can create new elements by combining them, as can be seen in \texttt{tikzlibraryforsyde.code.tex}. Following is a list with these shapes:

% \begin{optionslist}
% \item \texttt{ports e[0..10]o[0..10]} : defines anchors for the input/output pwrts.
% \item \texttt{func[0..4]} : defines boxes and anchors for the functions nodes.
% \item \texttt{leaf shape} : the shape of a standard leaf process outer box.
% \item \texttt{zip shape} : the shape of a custom zip process.
% \item \texttt{interface shape 0} : the node shape of an interface process.
% \item \texttt{interface shape 180} : the node shape of a reversed interface process.
% \item \texttt{comp shape} : the shape of a composite process.
% \item \texttt{dp shape} : the shape of a data-parallel pattern.
% \item \texttt{pipe shape} : the shape of a time-parallel (pipelined) pattern.
% \item \texttt{merge shape} : the shape of a merging (e.g. reduce) pattern.
% \item \texttt{custom conduit i[2..8]o[2..8]} : the inner node depicting the conduit in a custom (visual) transition pattern.
% \item \texttt{trans shape v[1..8]v[1..8]} : the outer box of a transition pattern, depicting vector(s) on one side and vector(s) on the other side.
% \item \texttt{trans shape s1v1} : the outer box of a transition pattern, depicting a signal on one side and a vector on the other side.
% \item \texttt{trans shape v1gv1} : the outer box of a transition pattern, depicting a vector on one side and a group of vectors on the other side.
% \end{optionslist}


% \begin{tikzpicture}[]
% \newleaf[]{lc}{0,0}{hallo};  
% \newleaf[ni=2, anchor=north]{l1}{2,0}{hallo1};
% \basic[shape=primitive,nf=1] {u} {3,0} {q};
% \end{tikzpicture}


\end{document}
%%% Local Variables:
%%% TeX-command-default: "Make"
%%% mode: latex
%%% TeX-master: t
%%% End:
